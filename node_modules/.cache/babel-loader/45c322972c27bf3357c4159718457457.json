{"ast":null,"code":"var _jsxFileName = \"/Users/paraiii/Desktop/Todo-about-app-main 2/src/Components/Context/TodoContext.tsx\",\n    _s = $RefreshSig$();\n\nimport { useSnackbar } from \"notistack\";\nimport { createContext, useCallback, useEffect, useState } from \"react\";\nimport { AddTask } from \"../API/AddTask\";\nimport { DeleteTask } from \"../API/DeleteTask\";\nimport { GetAllTasks } from \"../API/GetAllTasks\";\nimport { UserLogin } from \"../API/UserLogin\";\nimport { RegisterUser } from \"../API/RegisterUser\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport const initialValue = {\n  todoList: [],\n  loading: false,\n  registerState: \"\",\n  login: data => {},\n  registerUser: data => {},\n  addTodo: todo => {},\n  removeTodo: id => {},\n  handleCheck: (id, checked) => {},\n  todoCompleted: (id, done) => {},\n  handleDelete: () => {},\n  authenticated: false\n};\nexport const TodoContext = /*#__PURE__*/createContext(initialValue);\nexport const TodoContextProvider = props => {\n  _s();\n\n  const {\n    children\n  } = props;\n  const [todoList, setTodoList] = useState([]);\n  const [loading, setLoading] = useState(false);\n  const {\n    enqueueSnackbar\n  } = useSnackbar();\n  const [authenticated, setAuthenticated] = useState(false);\n  const [registerState, setRegisterState] = useState(\"\");\n  useEffect(() => {\n    const value = window.localStorage.getItem(\"prefix-token\");\n\n    if (value) {\n      setAuthenticated(true);\n    }\n  }, []);\n  useEffect(() => {\n    if (!authenticated) {\n      return;\n    }\n\n    setLoading(true);\n    GetAllTasks().then(res => {\n      setLoading(false);\n      const todoDtos = res.data.data;\n      const todoItems = todoDtos.map(todoDto => {\n        const content = JSON.parse(todoDto.description);\n        return { ...content,\n          id: todoDto._id\n        };\n      });\n      setTodoList(todoItems);\n    }); // }, [todoList]); //不能有这个dependency\n  }, [authenticated]);\n\n  const addTodo = todo => {\n    const todoDto = {\n      \"description\": JSON.stringify(todo)\n    };\n    setLoading(true);\n    AddTask(todoDto).then(res => {\n      //点击button之后拿到response\n      setLoading(false);\n      todo.id = res.data.data._id;\n      setTodoList([...todoList, todo]);\n      enqueueSnackbar('Successfully done the operation.');\n    });\n  };\n\n  const removeTodo = id => {\n    DeleteTask(id).then(res => {\n      setTodoList(todoList.filter(item => {\n        return item.id !== id;\n      }));\n    });\n  };\n\n  const Register = data => {\n    setRegisterState(\"IN_PROGRESS\");\n    RegisterUser(data).then(res => {\n      window.localStorage.setItem(\"prefix-token\", res.data.token);\n      setRegisterState(\"OK\"); // setAuthenticated(true)\n\n      console.log(Response);\n    });\n  };\n\n  const Login = data => {\n    UserLogin(data).then(res => {\n      window.localStorage.setItem(\"prefix-token\", res.data.token);\n      setAuthenticated(true);\n    });\n  };\n\n  const handleCheck = useCallback((id, checked) => {\n    const modifiedTodoList = todoList.map(todoItem => {\n      if (todoItem.id === id) {\n        todoItem.checked = !todoItem.checked;\n      }\n\n      return todoItem;\n    });\n    setTodoList(modifiedTodoList);\n  }, [todoList]);\n\n  const todoCompleted = (id, done) => {\n    const setList = todoList.map(todoItem => {\n      if (todoItem.id === id) {\n        todoItem.done = !todoItem.done;\n      }\n\n      return todoItem;\n    });\n    setTodoList(setList);\n  };\n\n  const handleDelete = useCallback(() => {\n    const filteredTodoList = todoList.filter(todoItem => todoItem.checked === false);\n    setTodoList(filteredTodoList);\n  }, [todoList]);\n  const values = {\n    todoList: todoList,\n    loading: loading,\n    registerState: registerState,\n    login: Login,\n    registerUser: Register,\n    addTodo: addTodo,\n    removeTodo: removeTodo,\n    handleCheck: handleCheck,\n    todoCompleted: todoCompleted,\n    handleDelete: handleDelete,\n    authenticated: authenticated\n  };\n  return /*#__PURE__*/_jsxDEV(TodoContext.Provider, {\n    value: values,\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 157,\n    columnNumber: 9\n  }, this);\n};\n\n_s(TodoContextProvider, \"5JCsLGWBhc2zD7nX9g8HJZ8I5JA=\", false, function () {\n  return [useSnackbar];\n});\n\n_c = TodoContextProvider;\n\nvar _c;\n\n$RefreshReg$(_c, \"TodoContextProvider\");","map":{"version":3,"sources":["/Users/paraiii/Desktop/Todo-about-app-main 2/src/Components/Context/TodoContext.tsx"],"names":["useSnackbar","createContext","useCallback","useEffect","useState","AddTask","DeleteTask","GetAllTasks","UserLogin","RegisterUser","initialValue","todoList","loading","registerState","login","data","registerUser","addTodo","todo","removeTodo","id","handleCheck","checked","todoCompleted","done","handleDelete","authenticated","TodoContext","TodoContextProvider","props","children","setTodoList","setLoading","enqueueSnackbar","setAuthenticated","setRegisterState","value","window","localStorage","getItem","then","res","todoDtos","todoItems","map","todoDto","content","JSON","parse","description","_id","stringify","filter","item","Register","setItem","token","console","log","Response","Login","modifiedTodoList","todoItem","setList","filteredTodoList","values"],"mappings":"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","sourcesContent":["import { useSnackbar } from \"notistack\";\nimport { createContext, useCallback, useEffect, useState } from \"react\";\nimport { AddTask } from \"../API/AddTask\";\nimport { DeleteTask } from \"../API/DeleteTask\";\nimport { GetAllTasks } from \"../API/GetAllTasks\";\nimport { TodoDto, TodoItem } from \"../types\";\nimport {UserLogin} from \"../API/UserLogin\";\nimport { RegisterUser } from \"../API/RegisterUser\";\n\ninterface TodoContextProp {\n    children: any;\n    value: TodoContextValue;\n}\ntype RegisterState = \"\" | \"IN_PROGRESS\" | \"OK\" | \"FAIL\";\n\nexport interface TodoContextValue {\n    todoList: TodoItem[];\n    loading: boolean;\n    registerState: RegisterState,\n    login: (data: {username: string, password: string}) => void;\n    registerUser: (data: {name: string, username: string, password: string}) => void;\n    addTodo: (todo: TodoItem) => void;\n    removeTodo: (id: string) => void;\n    handleCheck: (id: string, checked: boolean) => void;\n    todoCompleted: (id: string, done: boolean) => void;\n    handleDelete: () => void;\n    authenticated: boolean;\n}\nexport const initialValue: TodoContextValue = {\n    todoList: [],\n    loading: false,\n    registerState: \"\",\n    login: (data: {username: string, password: string}) => {},\n    registerUser: (data: {name: string, username: string, password: string}) => {},\n    addTodo: (todo:TodoItem)=>{},\n    removeTodo: (id: string) => {},\n    handleCheck: (id: string, checked: boolean) => {},\n    todoCompleted: (id: string, done: boolean) => {},\n    handleDelete: () => {},\n    authenticated: false,\n}\n\nexport const TodoContext = createContext(initialValue);\n\nexport const TodoContextProvider = (props: TodoContextProp) => {\n    const {children} = props;    \n    const [todoList, setTodoList] = useState<TodoItem[]>([]);\n    const [loading, setLoading] = useState<boolean>(false);      \n    const { enqueueSnackbar } = useSnackbar();\n    const [authenticated, setAuthenticated] = useState(false);\n    const [registerState, setRegisterState] = useState<RegisterState>(\"\");\n\n    useEffect (() => {\n        const value = window.localStorage.getItem(\"prefix-token\")\n        if (value) {\n            setAuthenticated(true)\n        }\n    }, [])\n    \n    useEffect (() => {\n        if (!authenticated) {\n            return;\n        }\n        setLoading(true);\n        GetAllTasks().then(res => {\n            setLoading(false);\n            const todoDtos = res.data.data;\n            const todoItems = todoDtos.map((todoDto: TodoDto) => {\n                const content: Partial<TodoItem> = JSON.parse(todoDto.description)\n                return { ...content, id: todoDto._id}\n            })\n            setTodoList(todoItems)\n       })\n    // }, [todoList]); //不能有这个dependency\n    }, [authenticated]);\n\n    const addTodo = (todo: TodoItem): void => {\n        const todoDto: Partial<TodoDto> = {\n            \"description\": JSON.stringify(todo)\n        }; \n        setLoading(true);\n        AddTask(todoDto).then(res => { //点击button之后拿到response\n            setLoading(false);\n            todo.id = res.data.data._id\n            setTodoList([...todoList, todo]);\n            enqueueSnackbar('Successfully done the operation.' )            \n        });\n    };  \n    \n    const removeTodo = (id: string): void => {\n        DeleteTask(id).then(res => {\n            setTodoList (\n                todoList.filter((item)=> {\n                    return item.id !== id;\n                })\n            );\n        })\n    };\n\n    const Register = (data: any): void => {\n        setRegisterState(\"IN_PROGRESS\")\n        RegisterUser (data).then(res => {\n            window.localStorage.setItem(\"prefix-token\", res.data.token);\n            setRegisterState(\"OK\");\n            // setAuthenticated(true)\n            console.log(Response);\n        })\n    ;}\n\n    const Login = (data: any): void => {\n        UserLogin (data).then(res => {\n            window.localStorage.setItem(\"prefix-token\", res.data.token);\n            setAuthenticated(true);\n        })\n    ;}\n\n    const handleCheck = useCallback ((id:string, checked: boolean) => {\n        const modifiedTodoList = todoList.map((todoItem) => {\n          if (todoItem.id === id) {\n            todoItem.checked = !todoItem.checked;\n          }\n          return todoItem;\n        });\n        setTodoList(modifiedTodoList);\n    }, [todoList]);\n\n    const todoCompleted = (id: string, done: boolean): void => {\n        const setList = todoList.map((todoItem)=> {\n            if (todoItem.id === id) {\n                todoItem.done = !todoItem.done;\n            }\n            return todoItem;\n        });   \n        setTodoList(setList);\n    };\n\n    const handleDelete = useCallback (() => {\n        const filteredTodoList = todoList.filter((todoItem) => todoItem.checked === false);\n        setTodoList(filteredTodoList);\n    }, [todoList]);\n\n    const values: TodoContextValue = {\n        todoList: todoList,\n        loading: loading,\n        registerState: registerState,\n        login: Login,\n        registerUser: Register,\n        addTodo: addTodo,\n        removeTodo: removeTodo,\n        handleCheck: handleCheck,\n        todoCompleted: todoCompleted,\n        handleDelete: handleDelete,\n        authenticated: authenticated,\n    };\n\n    return (\n        <TodoContext.Provider value={values}>\n            {children}\n        </TodoContext.Provider>\n    );\n}\n\n\n\n"]},"metadata":{},"sourceType":"module"}